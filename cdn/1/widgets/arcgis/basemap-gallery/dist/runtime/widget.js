System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel","esri/widgets/BasemapGallery/support/LocalBasemapsSource","esri/core/reactiveUtils","esri/Basemap","esri/widgets/BasemapGallery/support/BasemapGalleryItem"],(function(e,t){var a={},i={},n={},s={},l={},o={},r={},d={},u={};return{setters:[function(e){a.Immutable=e.Immutable,a.MutableStoreManager=e.MutableStoreManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.classNames=e.classNames,a.css=e.css,a.hooks=e.hooks,a.jsx=e.jsx},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.MapViewManager=e.MapViewManager,i.basemapUtils=e.basemapUtils},function(e){n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.WidgetPlaceholder=e.WidgetPlaceholder},function(e){s.default=e.default},function(e){l.default=e.default},function(e){o.default=e.default},function(e){r.default=e.default},function(e){d.default=e.default},function(e){u.default=e.default}],execute:function(){e((()=>{var e={25546:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><g clip-path="url(#a)"><path fill="#000" fill-rule="evenodd" d="M1 1h7v7H1zM0 9V0h9v9zm12-8h7v7h-7zm-1 8V0h9v9zm-3 3H1v7h7zm-8-1v9h9v-9zm12 1h7v7h-7zm-1 8v-9h9v9z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h20v20H0z"></path></clipPath></defs></svg>'},44692:e=>{"use strict";e.exports=d},62243:e=>{"use strict";e.exports=r},98992:e=>{"use strict";e.exports=s},86242:e=>{"use strict";e.exports=l},44795:e=>{"use strict";e.exports=u},51319:e=>{"use strict";e.exports=o},62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=a},14321:e=>{"use strict";e.exports=n}},t={};function c(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,c),n.exports}c.d=(e,t)=>{for(var a in t)c.o(t,a)&&!c.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var p={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(p),c.d(p,{__set_webpack_public_path__:()=>M,default:()=>y});var e,t=c(79244),a=c(62686),i=c(14321),n=c(98992),s=c(86242),l=c(51319),o=c(62243),r=c(44692);!function(e){e.Organization="ORGANIZATION",e.Custom="CUSTOM"}(e||(e={}));const d={_widgetLabel:"Basemap Gallery"};var u=c(44795),m=function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function l(e){try{r(i.next(e))}catch(e){s(e)}}function o(e){try{r(i.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,o)}r((i=i.apply(e,t||[])).next())}))};const v=(e,t)=>new u.default({basemap:e,view:t}),f=(0,t.Immutable)([]),g=(e,i,n)=>{const{id:s,mutableStateProps:l,useMapWidgetIds:o}=e,r=t.React.useMemo((()=>(null==l?void 0:l.cachedOrgBasemaps)||null),[null==l?void 0:l.cachedOrgBasemaps]),d=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(s,"cachedOrgBasemaps",e)}),[s]),u=t.React.useMemo((()=>(null==l?void 0:l.cachedOriginalBasemaps)||null),[null==l?void 0:l.cachedOriginalBasemaps]),c=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(s,"cachedOriginalBasemaps",e)}),[s]),p=t.React.useMemo((()=>(null==l?void 0:l.cachedBasemapGalleryInstance)||null),[null==l?void 0:l.cachedBasemapGalleryInstance]),v=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(s,"cachedBasemapGalleryInstance",e)}),[s]);t.hooks.useUpdateEffect((()=>()=>{c(h),v(n)}),[n]);const{set:g,store:h}=(e=>{const a=t.React.useRef(e);return{set:e=>{a.current=e},store:a.current}})(new Map);t.React.useEffect((()=>{(null==i?void 0:i.view)&&!h.get(i.id)&&h.set(i.id,i.view.map.basemap)}),[i,null==o?void 0:o[0]]);const w=t.ReactRedux.useSelector((e=>{var t,a;const i=null!==(t=e.appStateInBuilder)&&void 0!==t?t:e;return(null==o?void 0:o[0])?(null===(a=i.appConfig.widgets[o[0]])||void 0===a?void 0:a.useDataSources)||f:null}));return t.React.useEffect((()=>{if(w){const e=null==o?void 0:o[0],t=w.length?w.asMutable().map((t=>`${e}-${t.dataSourceId}`)):[`${e}-`];setTimeout((()=>{for(const e of h.keys())t.includes(e)||h.delete(e)}))}}),[w]),t.hooks.useUpdateEffect((()=>{(null==o?void 0:o[0])||g(new Map)}),[null==o?void 0:o[0]]),{hasGalleryCache:!!p,getOrgBasemaps:()=>m(void 0,void 0,void 0,(function*(){if(r)return[...r];const e=yield a.basemapUtils.getOrgBasemaps();return d(e),e})),applyCache:e=>(p&&e.appendChild(p.container),u&&g(u),p),originalBasemaps:h}};var h=function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function l(e){try{r(i.next(e))}catch(e){s(e)}}function o(e){try{r(i.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,o)}r((i=i.apply(e,t||[])).next())}))};const w=c(25546),b=t.css`
  &.jimu-basemap-widget {
    .gallery-container-parent{
      .esri-basemap-gallery.esri-component {
        width:100%;
        background-color: transparent !important;
        .esri-basemap-gallery__item {
          animation: none;
          transition: none;
        }
        .esri-basemap-gallery__item--selected {
          border-color: var(--sys-color-primary-main);
        }
      }
      .esri-component.esri-widget--panel-height-only {
        max-height: none;
      }
      .esri-basemap-gallery:focus-within {
        outline: none;
      }
    }
  }
`,y=u=>{const{useMapWidgetIds:c,config:p,id:m}=u,{basemapsType:f,customBasemaps:y}=p,M=t.hooks.useTranslation(d),[x,B]=t.React.useState(!0),[I,R]=t.React.useState(null),[S,C]=t.React.useState(),O=t.React.useMemo((()=>null==S?void 0:S.viewModel.items),[null==S?void 0:S.viewModel.items]),{getOrgBasemaps:j,hasGalleryCache:E,applyCache:k,originalBasemaps:_}=g(u,I,S),U=e=>"3d"===(null==e?void 0:e.type),V=t=>h(void 0,void 0,void 0,(function*(){let i=[];return i=f===e.Organization?yield j():yield a.basemapUtils.getLoadedBasemapList(r.default,y.asMutable()),U(t)?i:i.filter((e=>!a.basemapUtils.isBasemap3D(e)))})),G=e=>{const t=_.get(e.id)||e.view.map.basemap;if(!t)return;if(O.find((e=>S.viewModel.basemapEquals(e.basemap,t))))return;const a=v(t,null==e?void 0:e.view);O.unshift(a)};t.hooks.useUpdateEffect((()=>{!(null==c?void 0:c[0])&&I.view&&(I.view.map.basemap=_.get(I.id))}),[null==c?void 0:c[0]]);const P=(e,t)=>h(void 0,void 0,void 0,(function*(){if(R(e),S||E){if(S&&e){!t&&z.current.appendChild(S.container);if(e.id.split("-")[0]!==t.split("-")[0]){const e=a.MapViewManager.getInstance().getJimuMapViewById(t);(null==e?void 0:e.view)&&(e.view.map.basemap=_.get(t))}S.view=e.view,S.viewModel.items.forEach((t=>{t.view=e.view}));const i=yield V(e.view);S.source=new l.default({basemaps:i}),o.default.watch((()=>null==S?void 0:S.viewModel.items.map((e=>e.basemap.id))),(()=>{G(e)}),{once:!0})}}else i=e.view,h(void 0,void 0,void 0,(function*(){B(!0);const e=yield V(i),t=document&&document.createElement("div");t.className="esri-component h-100 w-100";const a=null==i?void 0:i.map.basemap,l=new s.default,o=!!e.find((e=>l.basemapEquals(a,e)));l.destroy();const r=new n.default({view:i,source:o||!a?e:[a,...e],container:t});C(r),0===z.current.childElementCount?z.current.appendChild(t):z.current.replaceChildren(t),B(!1)}));var i}));((e,a,i,n)=>{const s=t.hooks.usePrevious(e);t.hooks.useUpdateEffect((()=>{let t;t=e.length>s.length?a:e.length<s.length?i:n,t(s,e)}),[e])})(y,((e,t)=>h(void 0,void 0,void 0,(function*(){const e=t[t.length-1],i=(n=e,new r.default({portalItem:{id:n.id}}));var n;if(yield i.load(),!U(null==I?void 0:I.view)&&a.basemapUtils.isBasemap3D(i))return;O.push(v(i,I.view));S.viewModel.basemapEquals(_.get(I.id),i)&&O.shift()}))),((e,t)=>{const a=e.findIndex(((e,a)=>{var i;return e.id!==(null===(i=t[a])||void 0===i?void 0:i.id)})),i=e[a],n=O.findIndex((e=>{var t,a;return(null===(a=null===(t=null==e?void 0:e.basemap)||void 0===t?void 0:t.portalItem)||void 0===a?void 0:a.id)===i.id}));if(n<0)return;const s=O.splice(n,1)[0],l=S.activeBasemap;if(!l)return;if(S.viewModel.basemapEquals(s.basemap,l)){const e=_.get(I.id);G(I),S.activeBasemap=e}}),((e,t)=>{const a=e.filter((e=>!!O.find((t=>{var a,i;return(null===(i=null===(a=null==t?void 0:t.basemap)||void 0===a?void 0:a.portalItem)||void 0===i?void 0:i.id)===e.id})))),i=t.filter((e=>!!O.find((t=>{var a,i;return(null===(i=null===(a=null==t?void 0:t.basemap)||void 0===a?void 0:a.portalItem)||void 0===i?void 0:i.id)===e.id})))),n=((e,t)=>{if(e.length!==t.length||!e.length||!t.length)return null;const a=e.map(((e,t)=>({item:e,index:t}))).filter(((e,a)=>e.item!==t[a]));if(!a.length)return null;const i=t.map(((e,t)=>({item:e,index:t}))).slice(a[0].index,a[a.length-1].index+1);for(let e=0;e<a.length;e++){const t=a[e],n=i.findIndex((e=>e.item===t.item)),s=[...a];s.splice(e,1);const l=[...i];if(l.splice(n,1),s.every(((e,t)=>e.item===l[t].item)))return{from:t.index,to:i[n].index}}})(a.asMutable(),i.asMutable());if(!n)return;let{from:s,to:l}=n;a.length<O.length&&(s+=1,l+=1);const o=O.splice(s,1)[0];O.splice(l,0,o)})),t.hooks.useUpdateEffect((()=>{B(!0),V(null==I?void 0:I.view).then((e=>{S.viewModel.items.removeAll(),S.viewModel.items.addMany(e.map((e=>v(e,I.view)))),G(I);const t=_.get(I.id);S.viewModel.basemapEquals(t,S.activeBasemap)||e.find((e=>S.viewModel.basemapEquals(e,S.activeBasemap)))||(S.activeBasemap=t),B(!1)}))}),[f]);const z=t.React.useRef(),L=e=>{if(e&&(z.current=e,!S)){const t=k(e);t&&(C(t),B(!1))}};return(null==c?void 0:c.length)?(0,t.jsx)("div",{className:"jimu-widget jimu-basemap-widget surface-1 border-0",css:b},(0,t.jsx)("div",{ref:L,role:"listbox",className:(0,t.classNames)("gallery-container-parent","h-100",{"d-none":x})}),x&&(0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary}),(0,t.jsx)(a.JimuMapViewComponent,{useMapWidgetId:c[0],onActiveViewChange:P})):(0,t.jsx)(i.WidgetPlaceholder,{icon:w,widgetId:m,message:M("_widgetLabel")})};function M(e){c.p=e}})(),p})())}}}));